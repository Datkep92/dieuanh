<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Qu·∫£n l√Ω V·∫≠t T∆∞ c·ªßa Di·ªáu √Ånh</title>

  <!-- SheetJS -->
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getDatabase } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-analytics.js";

    const firebaseConfig = {
      apiKey: "AIzaSyACEtedbOCqJIUR4FeWLn7uuxoJBj7qgSw",
      authDomain: "dieuanh-fbcee.firebaseapp.com",
      databaseURL: "https://dieuanh-fbcee-default-rtdb.firebaseio.com",
      projectId: "dieuanh-fbcee",
      storageBucket: "dieuanh-fbcee.firebasestorage.app",
      messagingSenderId: "861273121859",
      appId: "1:861273121859:web:04a26a3054c4c4f8d720f6",
      measurementId: "G-HT0VECDWC9"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    window.db = getDatabase(app);
    window.firebaseReady = true;
  </script>

  <link rel="stylesheet" href="style.css">
</head>
<body>

<header id="mainHeader">
 <div class="header-group1">
    <!-- ‚úÖ INPUT FILE B·ªåC TRONG LABEL (nh∆∞ button) -->
    <label for="excelInput" class="file-btn">
      üìÅ Ch·ªçn file
      <input id="excelInput" type="file" accept=".xlsx,.xls" multiple style="display: none;">
    </label>
    
    <button id="xuatBtn" title="Xu·∫•t h√†ng">üöö Xu·∫•t</button>
    <button id="viewPhieu" title="Danh s√°ch nh·∫≠n">üìã Nh·∫≠n</button>
    <button id="lichSuNhan" title="L·ªãch s·ª≠ nh·∫≠n h√†ng">üìÖ L·ªãch s·ª≠</button>
  </div>

  <div class="header-group2">
    <button id="toggleSidebar" class="mobile-only" title="·∫®n/hi·ªán danh s√°ch phi·∫øu">Danh s√°ch</button>
    <button id="clearBtn" title="X√≥a to√†n b·ªô d·ªØ li·ªáu">X√≥a</button>
  </div>
</header>

<main id="mainContent">
  <div id="left">
    <h3>Danh s√°ch phi·∫øu nh·∫≠p kho</h3>
    <div class="search-box"><input id="searchCodes" type="text" placeholder="T√¨m theo m√£ ho·∫∑c ng√†y..."></div>
    <div id="codes"></div>
  </div>

  <div id="center">
    <!-- B·ªô l·ªçc th·ªùi gian -->
    <div id="stockFilter" class="filter-bar" style="display:none;">
      <div class="filter-group"><label>T·ª´:</label><input type="date" id="stockFromDate"></div>
      <div class="filter-group"><label>ƒê·∫øn:</label><input type="date" id="stockToDate"></div>
      <div class="filter-group"><button id="applyStockFilter" class="main-btn">L·ªçc theo ng√†y</button></div>
      <div class="filter-group"><button id="toggleStockMode" class="main-btn">Chuy·ªÉn sang T·ªìn kho hi·ªán t·∫°i</button></div>
    </div>

    <div style="margin-bottom:16px;">
      <button id="showStockFilter" class="main-btn">Xem nh·∫≠p theo th·ªùi gian</button>
    </div>

    <!-- C·∫¢NH B√ÅO T·ªíN KHO TH·∫§P (m·ªü r·ªông) -->
    <div id="stockWarnings" class="stock-warnings">
      <h4 onclick="toggleWarnings()">C·∫£nh b√°o t·ªìn kho th·∫•p <span id="toggleArrow">Right Arrow</span></h4>
      <div id="warningList" class="warning-list" style="display:none;"></div>
    </div>

    <!-- B·∫¢NG T·ªíN KHO -->
    <div class="table-wrapper">
      <h3>B·∫£ng t·ªìn kho th·ª±c t·∫ø</h3>
      <div style="margin-bottom:16px;">
        <button id="addProductBtn" class="main-btn" title="Th√™m s·∫£n ph·∫©m m·ªõi v√†o t·ªìn kho">Th√™m s·∫£n ph·∫©m</button>
      </div>
      <div class="search-box"><input id="searchStock" type="text" placeholder="T√¨m s·∫£n ph·∫©m..."></div>
      <table id="stockTable">
        <thead>
          <tr>
            <th>STT</th><th>T√™n v·∫≠t t∆∞</th><th>ƒêVT</th>
            <th class="num">SL nh·∫≠p</th><th class="num">ƒê∆°n gi√°</th><th class="num">Th√†nh ti·ªÅn</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="stockTotal" class="stock-total" style="display:none; margin-top:16px; padding:12px; background:var(--primary-light); border-radius:8px; text-align:right; font-weight:bold;">
      <span>T·ªïng c·ªông: </span><span id="totalQty">0</span> s·∫£n ph·∫©m - <span id="totalAmount">0</span> VNƒê
    </div>
  </div>
</main>

  <!-- ========== POPUP CHI TI·∫æT PHI·∫æU ========== -->
  <div id="popup" class="popup" style="display:none;">
    <header>
      <div>Chi ti·∫øt phi·∫øu xu·∫•t</div>
      <button id="closePopup" class="popup-close-btn" title="ƒê√≥ng">‚úñ</button>
    </header>
    <div class="body">
      <div id="popupHeader" class="muted"></div>
      <div class="table-wrapper">
        <table id="popupTable">
          <thead>
            <tr>
              <th style="width:48px">STT</th>
              <th>T√™n v·∫≠t t∆∞</th>
              <th style="width:80px">ƒêVT</th>
              <th class="num" style="width:120px">SL y√™u c·∫ßu</th>
              <th class="num" style="width:120px">SL th·ª±c ph√°t</th>
              <th class="num" style="width:120px">ƒê∆°n gi√°</th>
              <th class="num" style="width:140px">Th√†nh ti·ªÅn</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ========== POPUP XU·∫§T H√ÄNG ========== -->
  <div id="xuatPopup" class="popup" style="display:none;">
    <header>
      <div>üöö Xu·∫•t h√†ng</div>
      <button id="closeXuat" class="popup-close-btn" title="ƒê√≥ng">‚úñ</button>
    </header>
    <div class="body">
      <div class="form-row">
        <!-- Nh√≥m Ph√≤ng/Ban -->
        <div class="form-group">
          <label>Ph√≤ng/Ban:</label>
          <select id="chonPhong"></select>
          <button id="themPhong" title="Th√™m ph√≤ng ban">‚ûï</button>
        </div>
        
        <!-- Nh√≥m Ng∆∞·ªùi nh·∫≠n -->
        <div class="form-group">
          <label>Ng∆∞·ªùi nh·∫≠n:</label>
          <input id="tenNhanVien" list="suggestTen">
          <datalist id="suggestTen"></datalist>
          <button id="themTen" title="Th√™m ng∆∞·ªùi nh·∫≠n">‚ûï</button>
        </div>
        
        <!-- N√∫t x√°c nh·∫≠n -->
        <button id="confirmXuat" class="main-btn">üöö X√°c nh·∫≠n xu·∫•t h√†ng</button>
      </div>
      <div class="search-box">
        <input id="searchXuat" type="text" placeholder="T√¨m s·∫£n ph·∫©m...">
      </div>

      <div class="table-wrapper">
        <table id="xuatTable">
          <thead>
            <tr>
              <th>STT</th>
              <th>T√™n v·∫≠t t∆∞</th>
              <th>ƒêVT</th>
              <th>SL t·ªìn</th>
              <th>SL xu·∫•t</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ‚úÖ TH√äM POPUP TH√äM S·∫¢N PH·∫®M M·ªöI -->
  <div id="addProductPopup" class="popup" style="display:none;">
    <header>
      <div>‚ûï Th√™m s·∫£n ph·∫©m m·ªõi</div>
      <button id="closeAddProduct" class="popup-close-btn" title="ƒê√≥ng">‚úñ</button>
    </header>
    <div class="body">
      <div class="form-row">
        <div class="form-group">
          <label>T√™n s·∫£n ph·∫©m:</label>
          <input type="text" id="newProductName" placeholder="Nh·∫≠p t√™n v·∫≠t t∆∞" required>
        </div>
        <div class="form-group">
          <label>ƒê∆°n v·ªã (ƒêVT):</label>
          <input type="text" id="newProductUnit" placeholder="V√≠ d·ª•: c√°i, kg..." required>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>S·ªë l∆∞·ª£ng t·ªìn:</label>
          <input type="number" id="newProductQty" min="0" step="0.01" placeholder="0" required>
        </div>
        <div class="form-group">
          <label>ƒê∆°n gi√° (VNƒê):</label>
          <input type="number" id="newProductPrice" min="0" step="0.01" placeholder="0" required>
        </div>
      </div>
      <div style="text-align: center; margin-top: 20px;">
        <button id="saveNewProduct" class="main-btn">üíæ L∆∞u s·∫£n ph·∫©m</button>
        <div id="addProductError" style="color: var(--danger); margin-top: 8px; font-size: 14px;"></div>
      </div>
    </div>
  </div>

  <!-- ‚úÖ JS -->
  <script type="module" src="script.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Quáº£n lÃ½ tá»“n kho tá»« Excel</title>

  <!-- âœ… ThÆ° viá»‡n Ä‘á»c Excel (SheetJS) -->
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

  <!-- âœ… Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getDatabase } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-analytics.js";

    const firebaseConfig = {
      apiKey: "AIzaSyACEtedbOCqJIUR4FeWLn7uuxoJBj7qgSw",
      authDomain: "dieuanh-fbcee.firebaseapp.com",
      databaseURL: "https://dieuanh-fbcee-default-rtdb.firebaseio.com",
      projectId: "dieuanh-fbcee",
      storageBucket: "dieuanh-fbcee.firebasestorage.app",
      messagingSenderId: "861273121859",
      appId: "1:861273121859:web:04a26a3054c4c4f8d720f6",
      measurementId: "G-HT0VECDWC9"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    window.db = getDatabase(app);
    window.firebaseReady = true;
  </script>

  <!-- âœ… CSS tÃ¡ch riÃªng -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

 <header id="mainHeader">
  <!-- Title luÃ´n á»Ÿ Ä‘áº§u trÃªn mobile -->
  <div class="header-title mobile-title">
    Quáº£n lÃ½ Váº­t TÆ° cá»§a Diá»‡u Ãnh
  </div>
  
  <!-- NhÃ³m 1: 4 buttons ngang (file input bá»c nhÆ° button + 3 buttons) -->
  <div class="header-group1">
    <!-- âœ… INPUT FILE Bá»ŒC TRONG LABEL (nhÆ° button) -->
    <label for="excelInput" class="file-btn">
      ğŸ“ Chá»n file
      <input id="excelInput" type="file" accept=".xlsx,.xls" multiple style="display: none;">
    </label>
    
    <button id="xuatBtn" title="Xuáº¥t hÃ ng">ğŸšš Xuáº¥t</button>
    <button id="viewPhieu" title="Danh sÃ¡ch nháº­n">ğŸ“‹ Nháº­n</button>
    <button id="lichSuNhan" title="Lá»‹ch sá»­ nháº­n hÃ ng">ğŸ“… Lá»‹ch sá»­</button>
  </div>
  
  <!-- NhÃ³m 2: 2 Ã´ ngang - Toggle + XÃ³a -->
  <div class="header-group2">
    <!-- âœ… THÃŠM NÃšT TOGGLE CHO MOBILE -->
    <button id="toggleSidebar" class="mobile-only" title="áº¨n/hiá»‡n danh sÃ¡ch phiáº¿u">â˜° Danh sÃ¡ch</button>
    <button id="clearBtn" title="XÃ³a toÃ n bá»™ dá»¯ liá»‡u">ğŸ—‘ï¸ XÃ³a</button>
  </div>
</header>

  <!-- ========== MAIN ========== -->
  <main id="mainContent">
    <div id="left">
      <h3>Danh sÃ¡ch phiáº¿u nháº­p kho</h3>
      <div class="search-box">
        <input id="searchCodes" type="text" placeholder="TÃ¬m theo mÃ£ hoáº·c ngÃ y...">
      </div>
      <div id="codes"></div>
    </div>

    <!-- Trong pháº§n center cá»§a index.html -->
<div id="center">
  
  
  <!-- Bá»™ lá»c thá»i gian -->
  <div id="stockFilter" class="filter-bar" style="display: none;">
    <div class="filter-group">
      <label>ğŸ“… Tá»«:</label>
      <input type="date" id="stockFromDate">
    </div>
    <div class="filter-group">
      <label>Äáº¿n:</label>
      <input type="date" id="stockToDate">
    </div>
    <div class="filter-group">
      <button id="applyStockFilter" class="main-btn">ğŸ” Lá»c theo ngÃ y</button>
    </div>
    <div class="filter-group">
      <button id="toggleStockMode" class="main-btn">Chuyá»ƒn sang Tá»“n kho hiá»‡n táº¡i</button>
    </div>
  </div>

  <!-- NÃºt toggle -->
  <div style="margin-bottom: 16px;">
    <button id="showStockFilter" class="main-btn">ğŸ“Š Xem nháº­p theo thá»i gian</button>
  </div>

  
  
  <!-- Cáº£nh bÃ¡o tá»“n kho -->
  <div id="stockWarnings" class="stock-warnings" style="display: none;">
    <h4>âš ï¸ Cáº£nh bÃ¡o tá»“n kho tháº¥p</h4>
    <div id="warningList" class="warning-list"></div>
  </div>

  <!-- Báº£ng tá»“n kho -->
  <div class="table-wrapper">
    <h3>Báº£ng tá»“n kho thá»±c táº¿</h3>
    <!-- âœ… THÃŠM NÃšT THÃŠM Sáº¢N PHáº¨M PHÃA TRÃŠN Báº¢NG Tá»’N KHO -->
  <div style="margin-bottom: 16px;">
    <button id="addProductBtn" class="main-btn" title="ThÃªm sáº£n pháº©m má»›i vÃ o tá»“n kho">â• ThÃªm sáº£n pháº©m</button>
  </div>
    <table id="stockTable">
      <thead>
        <tr>
          <th>STT</th>
          <th>TÃªn váº­t tÆ°</th>
          <th>ÄVT</th>
          <th class="num">SL nháº­p</th>
          <th class="num">ÄÆ¡n giÃ¡</th>
          <th class="num">ThÃ nh tiá»n</th>
          <th></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Tá»•ng cá»™ng hiá»ƒn thá»‹ dáº¡ng vÄƒn báº£n -->
  <div id="stockTotal" class="stock-total" style="display: none; margin-top: 16px; padding: 12px; background: var(--primary-light); border-radius: 8px; text-align: right; font-weight: bold;">
    <span>Tá»•ng cá»™ng: </span>
    <span id="totalQty">0</span> sáº£n pháº©m - 
    <span id="totalAmount">0</span> VNÄ
  </div>
</div>
  </main>

  <!-- ========== POPUP CHI TIáº¾T PHIáº¾U ========== -->
  <div id="popup" class="popup" style="display:none;">
    <header>
      <div>Chi tiáº¿t phiáº¿u xuáº¥t</div>
      <button id="closePopup" class="popup-close-btn" title="ÄÃ³ng">âœ–</button>
    </header>
    <div class="body">
      <div id="popupHeader" class="muted"></div>
      <div class="table-wrapper">
        <table id="popupTable">
          <thead>
            <tr>
              <th style="width:48px">STT</th>
              <th>TÃªn váº­t tÆ°</th>
              <th style="width:80px">ÄVT</th>
              <th class="num" style="width:120px">SL yÃªu cáº§u</th>
              <th class="num" style="width:120px">SL thá»±c phÃ¡t</th>
              <th class="num" style="width:120px">ÄÆ¡n giÃ¡</th>
              <th class="num" style="width:140px">ThÃ nh tiá»n</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ========== POPUP XUáº¤T HÃ€NG ========== -->
  <div id="xuatPopup" class="popup" style="display:none;">
    <header>
      <div>ğŸšš Xuáº¥t hÃ ng</div>
      <button id="closeXuat" class="popup-close-btn" title="ÄÃ³ng">âœ–</button>
    </header>
    <div class="body">
      <div class="form-row">
        <!-- NhÃ³m PhÃ²ng/Ban -->
        <div class="form-group">
          <label>PhÃ²ng/Ban:</label>
          <select id="chonPhong"></select>
          <button id="themPhong" title="ThÃªm phÃ²ng ban">â•</button>
        </div>
        
        <!-- NhÃ³m NgÆ°á»i nháº­n -->
        <div class="form-group">
          <label>NgÆ°á»i nháº­n:</label>
          <input id="tenNhanVien" list="suggestTen">
          <datalist id="suggestTen"></datalist>
          <button id="themTen" title="ThÃªm ngÆ°á»i nháº­n">â•</button>
        </div>
        
        <!-- NÃºt xÃ¡c nháº­n -->
        <button id="confirmXuat" class="main-btn">ğŸšš XÃ¡c nháº­n xuáº¥t hÃ ng</button>
      </div>

      <div class="table-wrapper">
        <table id="xuatTable">
          <thead>
            <tr>
              <th>STT</th>
              <th>TÃªn váº­t tÆ°</th>
              <th>ÄVT</th>
              <th>SL tá»“n</th>
              <th>SL xuáº¥t</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- âœ… THÃŠM POPUP THÃŠM Sáº¢N PHáº¨M Má»šI -->
  <div id="addProductPopup" class="popup" style="display:none;">
    <header>
      <div>â• ThÃªm sáº£n pháº©m má»›i</div>
      <button id="closeAddProduct" class="popup-close-btn" title="ÄÃ³ng">âœ–</button>
    </header>
    <div class="body">
      <div class="form-row">
        <div class="form-group">
          <label>TÃªn sáº£n pháº©m:</label>
          <input type="text" id="newProductName" placeholder="Nháº­p tÃªn váº­t tÆ°" required>
        </div>
        <div class="form-group">
          <label>ÄÆ¡n vá»‹ (ÄVT):</label>
          <input type="text" id="newProductUnit" placeholder="VÃ­ dá»¥: cÃ¡i, kg..." required>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Sá»‘ lÆ°á»£ng tá»“n:</label>
          <input type="number" id="newProductQty" min="0" step="0.01" placeholder="0" required>
        </div>
        <div class="form-group">
          <label>ÄÆ¡n giÃ¡ (VNÄ):</label>
          <input type="number" id="newProductPrice" min="0" step="0.01" placeholder="0" required>
        </div>
      </div>
      <div style="text-align: center; margin-top: 20px;">
        <button id="saveNewProduct" class="main-btn">ğŸ’¾ LÆ°u sáº£n pháº©m</button>
        <div id="addProductError" style="color: var(--danger); margin-top: 8px; font-size: 14px;"></div>
      </div>
    </div>
  </div>

  <!-- âœ… JS -->
  <script type="module" src="script.js"></script>
</body>
</html>
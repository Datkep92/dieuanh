<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Quản lý tồn kho từ Excel</title>

  <!-- ✅ Thư viện đọc Excel (SheetJS) -->
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

  <!-- ✅ Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getDatabase } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-analytics.js";

    const firebaseConfig = {
      apiKey: "AIzaSyACEtedbOCqJIUR4FeWLn7uuxoJBj7qgSw",
      authDomain: "dieuanh-fbcee.firebaseapp.com",
      databaseURL: "https://dieuanh-fbcee-default-rtdb.firebaseio.com",
      projectId: "dieuanh-fbcee",
      storageBucket: "dieuanh-fbcee.firebasestorage.app",
      messagingSenderId: "861273121859",
      appId: "1:861273121859:web:04a26a3054c4c4f8d720f6",
      measurementId: "G-HT0VECDWC9"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    window.db = getDatabase(app);
    window.firebaseReady = true;
  </script>

  <!-- ✅ CSS tách riêng -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

 <header id="mainHeader">
  <!-- Title luôn ở đầu trên mobile -->
  <div class="header-title mobile-title">
    Quản lý Vật Tư của Diệu Ánh
  </div>
  
  <!-- Nhóm 1: 4 buttons ngang (file input bọc như button + 3 buttons) -->
  <div class="header-group1">
    <!-- ✅ INPUT FILE BỌC TRONG LABEL (như button) -->
    <label for="excelInput" class="file-btn">
      📁 Chọn file
      <input id="excelInput" type="file" accept=".xlsx,.xls" multiple style="display: none;">
    </label>
    
    <button id="xuatBtn" title="Xuất hàng">🚚 Xuất</button>
    <button id="viewPhieu" title="Danh sách nhận">📋 Nhận</button>
    <button id="lichSuNhan" title="Lịch sử nhận hàng">📅 Lịch sử</button>
  </div>
  
  <!-- Nhóm 2: 2 ô ngang - Toggle + Xóa -->
  <div class="header-group2">
    <!-- ✅ THÊM NÚT TOGGLE CHO MOBILE -->
    <button id="toggleSidebar" class="mobile-only" title="Ẩn/hiện danh sách phiếu">☰ Danh sách</button>
    <button id="clearBtn" title="Xóa toàn bộ dữ liệu">🗑️ Xóa</button>
  </div>
</header>

  <!-- ========== MAIN ========== -->
  <main id="mainContent">
    <div id="left">
      <h3>Danh sách phiếu nhập kho</h3>
      <div class="search-box">
        <input id="searchCodes" type="text" placeholder="Tìm theo mã hoặc ngày...">
      </div>
      <div id="codes"></div>
    </div>

    <!-- Trong phần center của index.html -->
<div id="center">
  
  
  <!-- Bộ lọc thời gian -->
  <div id="stockFilter" class="filter-bar" style="display: none;">
    <div class="filter-group">
      <label>📅 Từ:</label>
      <input type="date" id="stockFromDate">
    </div>
    <div class="filter-group">
      <label>Đến:</label>
      <input type="date" id="stockToDate">
    </div>
    <div class="filter-group">
      <button id="applyStockFilter" class="main-btn">🔍 Lọc theo ngày</button>
    </div>
    <div class="filter-group">
      <button id="toggleStockMode" class="main-btn">Chuyển sang Tồn kho hiện tại</button>
    </div>
  </div>

  <!-- Nút toggle -->
  <div style="margin-bottom: 16px;">
    <button id="showStockFilter" class="main-btn">📊 Xem nhập theo thời gian</button>
  </div>

  
  
  <!-- Cảnh báo tồn kho -->
  <div id="stockWarnings" class="stock-warnings" style="display: none;">
    <h4>⚠️ Cảnh báo tồn kho thấp</h4>
    <div id="warningList" class="warning-list"></div>
  </div>

  <!-- Bảng tồn kho -->
  <div class="table-wrapper">
    <h3>Bảng tồn kho thực tế</h3>
    <!-- ✅ THÊM NÚT THÊM SẢN PHẨM PHÍA TRÊN BẢNG TỒN KHO -->
  <div style="margin-bottom: 16px;">
    <button id="addProductBtn" class="main-btn" title="Thêm sản phẩm mới vào tồn kho">➕ Thêm sản phẩm</button>
  </div>
    <table id="stockTable">
      <thead>
        <tr>
          <th>STT</th>
          <th>Tên vật tư</th>
          <th>ĐVT</th>
          <th class="num">SL nhập</th>
          <th class="num">Đơn giá</th>
          <th class="num">Thành tiền</th>
          <th></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Tổng cộng hiển thị dạng văn bản -->
  <div id="stockTotal" class="stock-total" style="display: none; margin-top: 16px; padding: 12px; background: var(--primary-light); border-radius: 8px; text-align: right; font-weight: bold;">
    <span>Tổng cộng: </span>
    <span id="totalQty">0</span> sản phẩm - 
    <span id="totalAmount">0</span> VNĐ
  </div>
</div>
  </main>

  <!-- ========== POPUP CHI TIẾT PHIẾU ========== -->
  <div id="popup" class="popup" style="display:none;">
    <header>
      <div>Chi tiết phiếu xuất</div>
      <button id="closePopup" class="popup-close-btn" title="Đóng">✖</button>
    </header>
    <div class="body">
      <div id="popupHeader" class="muted"></div>
      <div class="table-wrapper">
        <table id="popupTable">
          <thead>
            <tr>
              <th style="width:48px">STT</th>
              <th>Tên vật tư</th>
              <th style="width:80px">ĐVT</th>
              <th class="num" style="width:120px">SL yêu cầu</th>
              <th class="num" style="width:120px">SL thực phát</th>
              <th class="num" style="width:120px">Đơn giá</th>
              <th class="num" style="width:140px">Thành tiền</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ========== POPUP XUẤT HÀNG ========== -->
  <div id="xuatPopup" class="popup" style="display:none;">
    <header>
      <div>🚚 Xuất hàng</div>
      <button id="closeXuat" class="popup-close-btn" title="Đóng">✖</button>
    </header>
    <div class="body">
      <div class="form-row">
        <!-- Nhóm Phòng/Ban -->
        <div class="form-group">
          <label>Phòng/Ban:</label>
          <select id="chonPhong"></select>
          <button id="themPhong" title="Thêm phòng ban">➕</button>
        </div>
        
        <!-- Nhóm Người nhận -->
        <div class="form-group">
          <label>Người nhận:</label>
          <input id="tenNhanVien" list="suggestTen">
          <datalist id="suggestTen"></datalist>
          <button id="themTen" title="Thêm người nhận">➕</button>
        </div>
        
        <!-- Nút xác nhận -->
        <button id="confirmXuat" class="main-btn">🚚 Xác nhận xuất hàng</button>
      </div>

      <div class="table-wrapper">
        <table id="xuatTable">
          <thead>
            <tr>
              <th>STT</th>
              <th>Tên vật tư</th>
              <th>ĐVT</th>
              <th>SL tồn</th>
              <th>SL xuất</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ✅ THÊM POPUP THÊM SẢN PHẨM MỚI -->
  <div id="addProductPopup" class="popup" style="display:none;">
    <header>
      <div>➕ Thêm sản phẩm mới</div>
      <button id="closeAddProduct" class="popup-close-btn" title="Đóng">✖</button>
    </header>
    <div class="body">
      <div class="form-row">
        <div class="form-group">
          <label>Tên sản phẩm:</label>
          <input type="text" id="newProductName" placeholder="Nhập tên vật tư" required>
        </div>
        <div class="form-group">
          <label>Đơn vị (ĐVT):</label>
          <input type="text" id="newProductUnit" placeholder="Ví dụ: cái, kg..." required>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Số lượng tồn:</label>
          <input type="number" id="newProductQty" min="0" step="0.01" placeholder="0" required>
        </div>
        <div class="form-group">
          <label>Đơn giá (VNĐ):</label>
          <input type="number" id="newProductPrice" min="0" step="0.01" placeholder="0" required>
        </div>
      </div>
      <div style="text-align: center; margin-top: 20px;">
        <button id="saveNewProduct" class="main-btn">💾 Lưu sản phẩm</button>
        <div id="addProductError" style="color: var(--danger); margin-top: 8px; font-size: 14px;"></div>
      </div>
    </div>
  </div>

  <!-- ✅ JS -->
  <script type="module" src="script.js"></script>
</body>
</html>